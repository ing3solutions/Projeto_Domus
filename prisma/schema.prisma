generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Condominio {
  id        Int      @id @default(autoincrement())
  nome      String
  endereco  String?
  cnpj      String?  @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users       User[]
  chamados    Chamado[]
  eventos     Evento[]
  documentos  Documento[]
  prestadores Prestador[]
  espacos     Espaco[]
  avisos      Aviso[]
  blocos      Bloco[]
}

model User {
  id           Int      @id @default(autoincrement())
  nome         String
  email        String   @unique
  senha        String
  role         Role     @default(MORADOR)
  telefone     String?
  unidadeId    Int?
  condominioId Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  condominio   Condominio   @relation(fields: [condominioId], references: [id])
  unidade      Unidade?     @relation(fields: [unidadeId], references: [id])
  chamados     Chamado[]    @relation("ChamadoCriador")
  responsavel  Chamado[]    @relation("ChamadoResponsavel")
  reservas     Reserva[]
  encomendas   Encomenda[]
  veiculos     Veiculo[]
  pets         Pet[]
}

enum Role {
  ADMIN
  SINDICO
  MORADOR
  PORTEIRO
}

model Chamado {
  id           Int            @id @default(autoincrement())
  titulo       String
  descricao    String
  tipo         TipoChamado    @default(MANUTENCAO)
  status       StatusChamado  @default(ABERTO)
  prioridade   Prioridade     @default(MEDIA)
  local        String?
  anexos       String[]
  criadorId    Int
  responsavelId Int?
  condominioId Int
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  criador      User           @relation("ChamadoCriador", fields: [criadorId], references: [id])
  responsavel  User?          @relation("ChamadoResponsavel", fields: [responsavelId], references: [id])
  condominio   Condominio     @relation(fields: [condominioId], references: [id])
}

enum TipoChamado {
  MANUTENCAO
  BARULHO
  SEGURANCA
  LIMPEZA
  OUTROS
}

enum StatusChamado {
  ABERTO
  EM_ANDAMENTO
  RESOLVIDO
}

enum Prioridade {
  BAIXA
  MEDIA
  ALTA
  URGENTE
}

model Evento {
  id           Int         @id @default(autoincrement())
  titulo       String
  descricao    String?
  data         DateTime
  hora         String?
  local        String?
  tipo         TipoEvento  @default(ASSEMBLEIA)
  status       StatusEvento @default(AGENDADO)
  condominioId Int
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  condominio   Condominio  @relation(fields: [condominioId], references: [id])
}

enum TipoEvento {
  ASSEMBLEIA
  MANUTENCAO
  VISTORIA
  PAGAMENTO
  OUTROS
}

enum StatusEvento {
  AGENDADO
  EM_ANDAMENTO
  CONCLUIDO
  CANCELADO
}

model Documento {
  id           Int              @id @default(autoincrement())
  nome         String
  url          String
  categoria    CategoriaDoc     @default(OUTROS)
  visibilidade Visibilidade     @default(TODOS)
  condominioId Int
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  condominio   Condominio       @relation(fields: [condominioId], references: [id])
}

enum CategoriaDoc {
  ATA
  CONTRATO
  BALANCETE
  REGULAMENTO
  OUTROS
}

enum Visibilidade {
  TODOS
  SINDICO
  ADMIN
}

model Prestador {
  id                 Int      @id @default(autoincrement())
  nome               String
  servico            String
  telefone           String?
  email              String?
  contratoVencimento DateTime?
  condominioId       Int
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  condominio         Condominio @relation(fields: [condominioId], references: [id])
}

model Espaco {
  id           Int       @id @default(autoincrement())
  nome         String
  descricao    String?
  capacidade   Int?
  valorReserva Float?
  regras       String?
  imagem       String?
  condominioId Int
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  condominio   Condominio @relation(fields: [condominioId], references: [id])
  reservas     Reserva[]
}

model Reserva {
  id         Int           @id @default(autoincrement())
  data       DateTime
  horarioInicio String?
  horarioFim    String?
  status     StatusReserva @default(PENDENTE)
  observacao String?
  espacoId   Int
  moradorId  Int
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  espaco     Espaco        @relation(fields: [espacoId], references: [id])
  morador    User          @relation(fields: [moradorId], references: [id])
}

enum StatusReserva {
  PENDENTE
  APROVADA
  REJEITADA
  CANCELADA
}

model Encomenda {
  id              Int              @id @default(autoincrement())
  descricao       String
  remetente       String?
  status          StatusEncomenda  @default(NA_PORTARIA)
  dataRecebimento DateTime         @default(now())
  dataEntrega     DateTime?
  destinatarioId  Int
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  destinatario    User             @relation(fields: [destinatarioId], references: [id])
}

enum StatusEncomenda {
  NA_PORTARIA
  NOTIFICADO
  ENTREGUE
}

model Aviso {
  id            Int            @id @default(autoincrement())
  titulo        String
  conteudo      String
  prioridade    PrioridadeAviso @default(INFORMATIVO)
  dataExpiracao DateTime?
  condominioId  Int
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  condominio    Condominio     @relation(fields: [condominioId], references: [id])
}

enum PrioridadeAviso {
  INFORMATIVO
  MANUTENCAO
  URGENTE
}

model Bloco {
  id           Int        @id @default(autoincrement())
  nome         String
  condominioId Int
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  condominio   Condominio @relation(fields: [condominioId], references: [id])
  unidades     Unidade[]
}

model Unidade {
  id        Int      @id @default(autoincrement())
  numero    String
  andar     Int?
  blocoId   Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bloco     Bloco    @relation(fields: [blocoId], references: [id])
  moradores User[]
}

model Veiculo {
  id        Int      @id @default(autoincrement())
  placa     String
  modelo    String?
  cor       String?
  moradorId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  morador   User     @relation(fields: [moradorId], references: [id])
}

model Pet {
  id        Int      @id @default(autoincrement())
  nome      String
  tipo      String?
  raca      String?
  moradorId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  morador   User     @relation(fields: [moradorId], references: [id])
}
